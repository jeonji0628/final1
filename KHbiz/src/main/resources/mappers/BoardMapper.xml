<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="BoardMapper">
  
  	<insert id="reply" parameterType="com.KHbiz.board.ReplyDTO">
  	insert into reply values(reply_seq.nextVal,#{id},#{contents},sysdate,#{num})
  	</insert>
  	
  	<select id="replyView" resultType="com.KHbiz.board.ReplyDTO">
  		select * from reply where ref=#{num}
  	</select>
  
   <select id="boardView" resultType="com.KHbiz.board.BoardDTO">
  		select * from board where num=#{num}
  </select>  
  
  <update id="countsUp" parameterType="java.lang.Integer">
  	update board set counts=counts+1 where num=#{num}
  </update>
  
  <insert id="boardWrite" parameterType="com.KHbiz.board.BoardDTO">
  insert into board values(board_seq.nextVal,#{id},#{title},#{contents},sysdate,0,#{kind},board_seq.currVal)
  </insert>
  
  	 <sql id="test">
  		<if test="searchType == 'title'.toString()">
  			and title like '%${searchWord}%'
  			<!-- and title like '%' ||#{searchWord} || '%' -->
  			<!-- and title like CONCAT('%',CONCAT(#{searchWord},'%')) -->
  		</if>
  		<if test="searchType == 'id'.toString()">
  			and id like '%${searchWord}%'
  		</if>
  		<if test="searchType == 'contents'.toString()">
  			and contents like '%${searchWord}%'
  		</if>
  	</sql>
  	<select id="search" resultType="com.KHbiz.board.BoardDTO">
  	select * from board where kind=#{kind} and num > 0
  	<include refid="test"></include>
  	</select>
  	
  	<select id="list" resultType="com.KHbiz.board.BoardDTO">
  	 select * from
      (select rownum R, A.* from 
      (select * from board where kind=#{kind} 
      <if test="searchType != null">
      <include refid="test"></include> 
      </if>
      order by num desc)A)
       where R between #{startRow} and #{lastRow}
  	</select>
  	
  	<update id="boardUpdate" parameterType="com.KHbiz.board.BoardDTO">
  	update board set title=#{title}, contents=#{contents}, counts=#{counts}-1, id=#{id}, kind=#{kind} where num=#{num}  	
  	</update>
   
  	
  <select id="totalList" resultType="java.lang.Integer">
  	select count(num) from board where kind=#{kind}
  </select>
  
  <select id="replyNum" resultType="java.lang.Integer">
  select count(num) from reply where ref=#{num}  
  </select>
 
  <delete id="boardDelete" parameterType="com.KHbiz.board.BoardDTO">
  delete from board where num=#{num}
  </delete>
  
  
  </mapper>